<#import "../layout/defaultLayout.ftl.html" as layout> <@layout.myLayout
"Dashboard | Show">

<#if !dashboard.id??>
	<h3>Dashboard ${id} is not exist!</h3>
<#else>

<div align="right">
	<div style="display: inline-flex;">
		<#if dashboard.owner == alias>
		<!-- Button trigger modal_add_gadget -->
		<button type="button" class="btn btn-default" data-toggle="modal" data-target="#modal_add_gadget">
			<i class="fa fa-plus" aria-hidden="true"></i> Add Gadget
		</button>
		</#if>
		<!-- Button trigger modal_edit_layout -->
		<button type="button" class="btn btn-default" data-toggle="modal" data-target="#modal_edit_layout">
			<i class="fa fa-pencil" aria-hidden="true"></i> Edit Layout
		</button>
		<li class="dropdown">
			<button class="btn btn-default dropdown-toggle"  data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
				<i class="fa fa-cog" aria-hidden="true"></i> Tools <span class="caret"></span>
			</button>
          	<ul class="dropdown-menu dropdown-menu-right">
          		<#if dashboard.owner == alias || role??>
					<li><a href="/dashboard/${id}/update">Update Dashboard</a></li>
					<li><a data-toggle="modal" data-target="#myModal">Delete Dashboard</a></li> 
				</#if>
            	<li><a href="/dashboard/${id}/clone">Clone Dashboard</a></li>
          	</ul>
        </li>
		
	</div>
</div>
<!-- modal_edit_layout -->
<div class="modal fade" id="modal_edit_layout" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header" style="background-color: #f0f0f0;">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">Edit Layout</h4>
			</div>
			<div class="modal-body" id="layout-dialog" style="height: 100px;">
				<b>Choose dashboard layout</b>
				<ul>
					<li><a href="#" id="layout-a" onclick="layouta()"><strong>A</strong></a></li>
					<li><a href="#" id="layout-aa" onclick="layoutaa()"><strong>AA</strong></a></li>
					<li><a href="#" id="layout-ba" onclick="layoutba()"><strong>BA</strong></a></li>
					<li><a href="#" id="layout-ab" onclick="layoutab()"><strong>AB</strong></a></li>
					<li><a href="#" id="layout-aaa" onclick="layoutaaa()"><strong>AAA</strong></a></li>
				</ul>
			</div>
			<div class="modal-footer" style="background-color: #f0f0f0;">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<!-- modal_add_gadget -->
<div class="modal fade" id="modal_add_gadget" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header" style="background-color: #f0f0f0;">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">Add Gadget</h4>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-md-4">
						<img class="media-object" data-src="holder.js/95x95" alt="95x95" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+PGRlZnMvPjxyZWN0IHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgZmlsbD0iI0VFRUVFRSIvPjxnPjx0ZXh0IHg9IjE0LjUiIHk9IjMyIiBzdHlsZT0iZmlsbDojQUFBQUFBO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1mYW1pbHk6QXJpYWwsIEhlbHZldGljYSwgT3BlbiBTYW5zLCBzYW5zLXNlcmlmLCBtb25vc3BhY2U7Zm9udC1zaXplOjEwcHQ7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9nPjwvc3ZnPg==" data-holder-rendered="true" style="width: 95px; height: 95px; padding-bottom: 10px;">
						<button class="btn btn-default" href="#" id="sonar-btn" disabled="disabled" onClick="sonarClick()">Add it Now</button>
					</div>
					<div class="col-md-8">
						<h4>AMS SONAR Statistics Gadget<br><small>By Le Cong Hau</small></h4>
						<p>Gadget to display statistics from AMS SONAR Setup</p>
						<h6><a href="http://www.tmasolutions.com/" target="_blank">http://www.tmasolutions.com/</a></h6>
					</div>
				</div>
				<hr>
				<div class="row">
					<div class="col-md-4">
						<img class="media-object" data-src="holder.js/95x95" alt="95x95" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+PGRlZnMvPjxyZWN0IHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgZmlsbD0iI0VFRUVFRSIvPjxnPjx0ZXh0IHg9IjE0LjUiIHk9IjMyIiBzdHlsZT0iZmlsbDojQUFBQUFBO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1mYW1pbHk6QXJpYWwsIEhlbHZldGljYSwgT3BlbiBTYW5zLCBzYW5zLXNlcmlmLCBtb25vc3BhY2U7Zm9udC1zaXplOjEwcHQ7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9nPjwvc3ZnPg==" data-holder-rendered="true" style="width: 95px; height: 95px; padding-bottom: 10px;">
						<button class="btn btn-default" href="#" id="review-btn" disabled="disabled" onClick="reviewClick()">Add it Now</button>
					</div>
					<div class="col-md-8">
						<h4>AMS Overdue Reviews Report Gadget<br><small>By Le Cong Hau</small></h4>
						<p>Gadget to display report of Overdue Reviews in AMS</p>
						<h6><a href="http://www.tmasolutions.com/" target="_blank">http://www.tmasolutions.com/</a></h6>
					</div>
				</div>
				<hr>
				<#include "show_sub_dashboard.ftl.html">
			</div>
			<div class="modal-footer" style="background-color: #f0f0f0;">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

<!-- Modal delete dashboard-->
<div class="modal fade bs-example-modal-sm" id="myModal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content" style="text-align: left;">
      <div class="modal-body">
        Are you sure?
      </div>
      <div class="modal-footer" style="text-align: left;">
        <a style="color: red;" href="/dashboard/${id}/delete">Delete</a>
        <a data-dismiss="modal">Cancel</a>
      </div>
    </div>
  </div>
</div>

<br>

<div id="lobipanel-custom-control"
	class="panel <#if dashboard.share == "public">panel-success<#else>panel-warning</#if> lobipanel-sortable mypanel1">
	<div class="panel-heading">
		<div class="panel-title">
			<h4>${dashboard.name}<#if dashboard.owner != alias> |
				${dashboard.owner}</#if></h4>
		</div>
	</div>
	<div class="panel-body">
		<div id="lobipanel-multiple">
			<div class="bs-example">
				<div class="row">
					<div id="sonar-div" class="col-md-8" style="min-height: 20px;">
						<div class="panel panel-info" data-initial-index="4">
							<div class="panel-heading">
								<div class="panel-title">
									<h4>SONAR Statistics <#if s_datas?keys?size != 0>for ${s_datas?keys?join(" | ")}</#if></h4>
								</div>
							</div>
							<div class="panel-body">
								<div class="text-align-right">
									<a id="sonar-config-toggle">Show Configuration</a>
								</div>
								<div id="sonar-config">
									<form action="/dashboard/${id}/update" method="post" class="form-horizontal" role="form">
        								<div class="md-padding" ng-cloak>
        									<table class="table table-bordered">
												<tbody>
													<tr>
														<td class="col-md-6">Implementation Authority Configuration *</td>
														<td class="col-md-6">
															<#list releases as release>
											                	<div class="radio">
																	<label>
																		<input type="radio" name="release" value="${release}" <#if dashboard.release??><#if dashboard.release?contains("${release}")>checked</#if></#if>>${release}
																	</label>
																</div>
											                </#list>
														</td>
													</tr>
													<tr>
														<td class="col-md-6">Implementation Authority *</td>
														<td class="col-md-6">
															<select multiple id="ia_list" name="s_ia" required>
											                	<#list s_ia as ia>
																  <option value="${ia}" <#if dashboard.s_ia??><#if dashboard.s_ia?contains("${ia}")>selected</#if></#if>>${ia}</option>
																</#list>
											                </select>
														</td>
													</tr>
													<tr>
														<td class="col-md-6">Metrics *</td>
														<td class="col-md-6">
															<select multiple name="metric" required>
										                    	<#list metrics as metric>
																  <option value="${metric.code}" <#if dashboard.metric??><#if dashboard.metric?contains("${metric.code}")>selected</#if></#if>>${metric.name}</option>
																</#list>
															</select>
														</td>
													</tr>
													<tr>
														<td class="col-md-6">Differential Analysis Period: *</td>
														<td class="col-md-6">
															<select name="period" required>
										                    	<#list periods?keys as k>
																  <option value="${k}" <#if dashboard.period??><#if dashboard.period?contains("${k}")>selected</#if></#if>>From ${periods[k]}</option>
																</#list>
															</select>
														</td>
													</tr>
												</tbody>
											</table>
        								</div>
        								<#if dashboard.owner == alias>
        								<button type="submit" class="btn btn-success">Update</button>
        								</#if>
    								</form>
								</div>
								<br>
								<table class="table table-striped table-bordered table-hover table-condensed">
									<thead>
										<tr>
											<#if s_data?first??>
												<th>Components</th> 
												<#list s_data?first.metric?keys as k>
													<#if k == "coverage"><th>Coverage</th></#if>
													<#if k == "critical_violations"><th>Critical Violations</th></#if> 
													<#if k == "new_coverage"><th>New Coverage</th></#if> 
													<#if k == "test_errors"><th>Unit Test Errors</th></#if> 
													<#if k == "test_execution_time"><th>Unit tests duration</th></#if> 
													<#if k == "test_failures"><th>Unit Test Failures</th></#if>
												</#list>
											</#if>	
										</tr>
									</thead>
									<tbody>
										<#list s_datas?keys as k>
											<tr>
												<td><b>${k}</b></td>
												<#if s_data?first??>
													<#list s_data?first.metric?keys as k>
														<td></td>
													</#list>
												</#if>
											</tr>
											<#list s_datas[k] as data>
												<tr>
												  	<td><a href="http://bamboo.in.alcatel-lucent.com:8085/overview?id=${data.id}">${data.name}</a></td>
												  	<#list data.metric?keys as k>
													  <#if k=="coverage"><td <#if data.metric[k] != "-" && data.metric[k]?remove_ending("%")?number < 80>class="violatedMetricValue"</#if>>${data.metric[k]}</td></#if>
													  <#if k=="critical_violations"><td <#if data.metric[k] != "-" && data.metric[k]?number gt 0>class="violatedMetricValue"</#if>>${data.metric[k]}</td></#if>
													  <#if k=="new_coverage"><td <#if data.metric[k] != "-" && data.metric[k]?number < 80>class="violatedMetricValue"</#if>>${data.metric[k]}</td></#if>
													  <#if k=="test_errors"><td <#if data.metric[k] != "-" && data.metric[k]?number gt 0>class="violatedMetricValue"</#if>>${data.metric[k]}</td></#if>
													  <#if k=="test_execution_time"><td <#if data.metric[k] != "-" && !data.metric[k]?contains("ms") && !data.metric[k]?contains("sec")>class="violatedMetricValue"</#if>>${data.metric[k]}</td></#if>
													  <#if k=="test_failures"><td <#if data.metric[k] != "-" && data.metric[k]?number gt 0>class="violatedMetricValue"</#if>>${data.metric[k]}</td></#if>
													</#list>
												</tr>
											</#list>
											<tr>
												<td></td>
												<#if s_data?first??>
													<#list s_data?first.metric?keys as k>
														<td></td>
													</#list>
												</#if>
											</tr>
										</#list>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div id="review-div" class="col-md-4" style="min-height: 20px;">
						<div class="panel panel-danger">
							<div class="panel-heading">
								<div class="panel-title">
									<h4>Overdue Reviews Report</h4>
								</div>
							</div>
							<div class="panel-body">
								<div class="text-align-right">
									<a id="odreview-config-toggle">Show Configuration</a>
								</div>
								<div id="odreview-config">
									<form action="/dashboard/${id}/update" method="post" class="form-horizontal" role="form">
								        <div class="md-padding" ng-cloak>
									        <div>
								                <md-input-container>
								                    <label>Username</label>
								                    <input <#if dashboard.r_ia??>value="${dashboard.r_ia}"</#if> name="r_ia">
								                </md-input-container>
								
								                <md-input-container>
								                    <label>Project name</label>
								                    <input <#if dashboard.project??>value="${dashboard.project}"</#if> name="project">
								                </md-input-container>
								            </div>
								        </div>
								        <#if dashboard.owner == alias>
								        <button type="submit" class="btn btn-success">Update</button>
								        </#if>
								    </form>	
								</div>
								<br>
								<table class="table table-striped table-bordered table-hover table-condensed">
									<thead>
										<tr>
											<th>User</th>
											<th>X &lt; 5</th>
											<th>5 &lt; X &lt; 10</th>
											<th>X &gt; 10</th>
										</tr>
									</thead>
									<tbody>
										<#list r_datas as data>
											<tr>
										  		<td>${data.ia}</td>
										  		<td>${data.less5}</td>
										  		<td>${data.more5less10}</td>
										  		<td>${data.more10}</td>
										  	</tr>
										</#list>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div id="widget-container">
						<#include "show_sub_dashboard_gadget.ftl.html">
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</#if> 
</@layout.myLayout>
